<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è±ç‰ç±ƒçƒéšŠ - 2025å±æ±ç›ƒ</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, #1565C0 0%, #0D47A1 100%);
      min-height: 100vh;
      padding: 20px;
      position: relative;
    }

    /* Admin link styled */
    .admin-link {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 10;
    }

    .admin-link > a {
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      font-size: 14px;
      opacity: 0.8;
      transition: opacity 0.3s ease;
      cursor: pointer;
    }

    .admin-link > a:hover {
      opacity: 1;
    }

    .admin-logged-in {
      display: none;
      background: rgba(255, 255, 255, 0.2);
      padding: 10px 20px;
      border-radius: 20px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .admin-info {
      display: flex;
      align-items: center;
      gap: 15px;
      color: white;
      font-size: 14px;
    }

    .admin-email {
      font-weight: 500;
    }

    .admin-actions {
      display: flex;
      gap: 10px;
    }

    .admin-btn {
      padding: 6px 14px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      font-size: 13px;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.2s ease;
      display: inline-block;
    }

    .admin-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-1px);
    }

    /* Admin Login Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      backdrop-filter: blur(5px);
    }

    .modal-overlay.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .login-modal {
      background: white;
      border-radius: 20px;
      padding: 0;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
      transform: translateY(20px);
      opacity: 0;
      animation: modalAppear 0.3s ease forwards;
    }

    @keyframes modalAppear {
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-header {
      background: linear-gradient(135deg, #1565C0 0%, #0D47A1 100%);
      padding: 30px;
      text-align: center;
      color: white;
    }

    .modal-header h3 {
      margin: 0;
      font-size: 24px;
      font-weight: bold;
    }

    .modal-body {
      padding: 30px;
    }

    .login-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .form-field {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-label {
      font-size: 14px;
      font-weight: 500;
      color: #344054;
    }

    .login-input {
      padding: 14px 18px;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      font-size: 16px;
      transition: all 0.3s ease;
      background-color: #f8f9fa;
    }

    .login-input:focus {
      outline: none;
      border-color: #1565C0;
      background-color: white;
      box-shadow: 0 0 0 4px rgba(21, 101, 192, 0.1);
    }

    .login-error {
      color: #dc3545;
      font-size: 14px;
      text-align: center;
      display: none;
      background: #fee;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #fcc;
    }

    .login-error.show {
      display: block;
    }

    .login-buttons {
      display: flex;
      gap: 12px;
      margin-top: 10px;
    }

    .login-btn {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .login-btn.primary {
      background: linear-gradient(135deg, #1565C0 0%, #0D47A1 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(21, 101, 192, 0.3);
    }

    .login-btn.primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(21, 101, 192, 0.4);
    }

    .login-btn.primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .login-btn.secondary {
      background: #f8f9fa;
      color: #6c757d;
      border: 2px solid #e9ecef;
    }

    .login-btn.secondary:hover {
      background: #e9ecef;
    }

    .loading-spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 0.8s linear infinite;
      margin-right: 8px;
      vertical-align: middle;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding-top: 20px;
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 32px;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    .header p {
      font-size: 20px;
      opacity: 0.95;
      font-weight: 500;
    }

    .error-message {
      background: rgba(255, 255, 255, 0.1);
      color: #ffcccb;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: center;
      border: 1px solid rgba(255, 204, 203, 0.3);
      display: none;
    }

    .error-message.show {
      display: block;
    }

    .loading-indicator {
      text-align: center;
      color: white;
      padding: 20px;
      font-size: 16px;
    }

    .form-card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }

    .form-title {
      font-size: 24px;
      font-weight: bold;
      color: #333;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    label {
      display: block;
      font-weight: 600;
      color: #555;
      margin-bottom: 8px;
      font-size: 16px;
    }

    select, input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      transition: all 0.3s;
      background: #fafafa;
    }

    select:focus, input:focus {
      outline: none;
      border-color: #1565C0;
      background: white;
      box-shadow: 0 0 0 3px rgba(21, 101, 192, 0.1);
    }

    .date-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-bottom: 15px;
    }

    .date-btn {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      padding: 12px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      font-size: 16px;
      font-weight: 600;
    }

    .date-btn:hover {
      border-color: #1565C0;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(21, 101, 192, 0.2);
    }

    .date-btn.selected {
      background: linear-gradient(135deg, #1565C0 0%, #0D47A1 100%);
      color: white;
      border-color: transparent;
    }

    .other-date-input {
      display: none;
      margin-top: 10px;
    }

    .other-date-input.show {
      display: block;
    }

    .flight-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .flight-btn {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: left;
      position: relative;
      overflow: hidden;
    }

    .flight-btn:hover {
      border-color: #1565C0;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(21, 101, 192, 0.2);
    }

    .flight-btn.selected {
      background: linear-gradient(135deg, #1565C0 0%, #0D47A1 100%);
      color: white;
      border-color: transparent;
    }

    .airline-logo {
      font-size: 24px;
      margin-bottom: 8px;
    }

    .flight-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 5px;
    }

    .flight-time {
      font-size: 18px;
      font-weight: bold;
    }

    .airline-name {
      font-size: 14px;
      color: #666;
      margin-bottom: 3px;
    }

    .flight-btn.selected .airline-name {
      color: rgba(255,255,255,0.8);
    }

    .manual-input-toggle {
      text-align: center;
      margin: 20px 0;
    }

    .toggle-btn {
      background: none;
      border: 2px dashed #1565C0;
      color: #1565C0;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s;
    }

    .toggle-btn:hover {
      background: #1565C0;
      color: white;
      border-style: solid;
    }

    .manual-input {
      display: none;
      margin-top: 20px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
      border: 2px solid #e0e0e0;
    }

    .manual-input.show {
      display: block;
    }

    .input-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 15px;
    }

    .form-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 20px;
      border: 2px solid #e9ecef;
    }

    .section-title {
      font-size: 18px;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-indicator {
      padding: 4px 12px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: 600;
      margin-left: auto;
    }

    .status-completed {
      background: #d4edda;
      color: #155724;
    }

    .status-required {
      background: #f8d7da;
      color: #721c24;
    }

    .submit-btn {
      background: linear-gradient(135deg, #1565C0 0%, #0D47A1 100%);
      color: white;
      border: none;
      padding: 15px 40px;
      border-radius: 10px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      width: 100%;
      box-shadow: 0 4px 15px rgba(21, 101, 192, 0.3);
    }

    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(21, 101, 192, 0.4);
    }

    .submit-btn:active {
      transform: translateY(0);
    }

    .table-card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    }

    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .member-count {
      background: linear-gradient(135deg, #1565C0 0%, #0D47A1 100%);
      color: white;
      padding: 8px 20px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 14px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead {
      background: #f8f9fa;
    }

    th {
      padding: 15px;
      text-align: left;
      font-weight: 600;
      color: #555;
      border-bottom: 2px solid #e0e0e0;
    }

    td {
      padding: 15px;
      border-bottom: 1px solid #f0f0f0;
    }

    tbody tr:hover {
      background: #f8f9fa;
    }

    .member-name {
      font-weight: 600;
      color: #333;
    }

    .flight-detail {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .airline-tag {
      display: inline-block;
      padding: 4px 12px;
      background: #e3f2fd;
      color: #0D47A1;
      border-radius: 15px;
      font-size: 12px;
      font-weight: 600;
    }

    .time-badge {
      background: #f3e5f5;
      color: #7b1fa2;
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
    }

    .date-badge {
      background: #e8f5e9;
      color: #2e7d32;
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 10px;
      opacity: 0.5;
    }

    .prefilled-info {
      background: #e8f5e9;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
      border-left: 4px solid #4caf50;
    }

    .prefilled-text {
      color: #2e7d32;
      font-weight: 500;
      margin-bottom: 10px;
    }

    .prefilled-details {
      font-size: 14px;
      color: #555;
    }

    @media (max-width: 768px) {
      .admin-logged-in {
        position: static;
        margin-bottom: 20px;
        border-radius: 16px;
      }

      .admin-info {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .flight-options {
        grid-template-columns: 1fr;
      }

      .input-row, .form-row {
        grid-template-columns: 1fr;
      }

      .table-card {
        overflow-x: auto;
      }

      table {
        min-width: 700px;
      }

      .date-options {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <!-- Admin link -->
  <div class="admin-link">
    <a onclick="showAdminLogin()" id="adminLoginLink">ç®¡ç†å“¡ç™»å…¥</a>
    <div class="admin-logged-in" id="adminLoggedIn">
      <div class="admin-info">
        <span class="admin-email" id="adminEmail"></span>
        <div class="admin-actions">
          <a href="toyotama-tw-flight-admin.html" class="admin-btn" target="_blank">ç®¡ç†é¢æ¿</a>
          <button class="admin-btn" onclick="logout()">ç™»å‡º</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Admin Login Modal -->
  <div class="modal-overlay" id="adminModal">
    <div class="login-modal">
      <div class="modal-header">
        <h3>ç®¡ç†å“¡ç™»å…¥</h3>
      </div>
      <div class="modal-body">
        <form class="login-form" id="adminLoginForm">
          <div class="form-field">
            <label class="form-label">Email</label>
            <input 
              type="email" 
              class="login-input" 
              id="adminEmailInput"
              placeholder="admin@example.com"
              required
            />
          </div>
          <div class="form-field">
            <label class="form-label">å¯†ç¢¼</label>
            <input 
              type="password" 
              class="login-input" 
              id="adminPasswordInput"
              placeholder="è«‹è¼¸å…¥å¯†ç¢¼"
              required
            />
          </div>
          <div class="login-error" id="loginError">ç™»å…¥å¤±æ•—ï¼š<span id="errorMessage"></span></div>
          <div class="login-buttons">
            <button type="submit" class="login-btn primary" id="loginSubmitBtn">
              <span id="loginBtnText">ç™»å…¥</span>
            </button>
            <button type="button" class="login-btn secondary" onclick="closeAdminLogin()">å–æ¶ˆ</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="header">
      <h1>ğŸ€ è±ç‰ç±ƒçƒéšŠ - 2025å±æ±ç›ƒ</h1>
      <p>éšŠå“¡è³‡è¨Šç™»è¨˜ç³»çµ±</p>
    </div>

    <div class="error-message" id="errorAlert">
      <strong>é€£ç·šéŒ¯èª¤ï¼š</strong><span id="errorText"></span>
    </div>

    <div class="loading-indicator" id="loadingIndicator">
      <div class="loading-spinner"></div>
      æ­£åœ¨é€£æ¥è³‡æ–™åº«...
    </div>

    <div id="mainContent" style="display: none;">
      <div class="form-card">
        <h2 class="form-title">
          <span>ğŸ“</span>
          <span>éšŠå“¡è³‡è¨Šç™»è¨˜</span>
        </h2>

        <form id="memberForm">
          <div class="form-group">
            <label for="memberName">éšŠå“¡å§“å</label>
            <select id="memberName" required>
              <option value="">è«‹é¸æ“‡éšŠå“¡</option>
              <option value="è¶™æ•™">è¶™æ•™</option>
              <option value="å¸ƒ">å¸ƒ</option>
              <option value="adain">adain</option>
              <option value="Alvin">Alvin</option>
              <option value="Earnest">Earnest</option>
              <option value="James">James</option>
              <option value="Jason">Jason</option>
              <option value="Martin">Martin</option>
              <option value="Pine">Pine</option>
              <option value="Rex">Rex</option>
              <option value="Tak">Tak</option>
              <option value="Tf">Tf</option>
              <option value="tsan">tsan</option>
              <option value="wingsun">wingsun</option>
              <option value="Yee">Yee</option>
              <option value="å¤§å¸«å…„">å¤§å¸«å…„</option>
              <option value="ä»">ä»</option>
              <option value="å…‰">å…‰</option>
              <option value="å¤©">å¤©</option>
              <option value="å¥¶">å¥¶</option>
              <option value="å®">å®</option>
              <option value="å·¨å³°">å·¨å³°</option>
              <option value="æ–‡å¨">æ–‡å¨</option>
              <option value="æ°">æ°</option>
              <option value="æ¯›">æ¯›</option>
              <option value="æ´²">æ´²</option>
              <option value="çš®">çš®</option>
              <option value="è¡¨">è¡¨</option>
              <option value="é”">é”</option>
              <option value="éŠ˜">éŠ˜</option>
            </select>
          </div>

          <!-- Personal Information Section -->
          <div class="form-section" id="personalSection">
            <div class="section-title">
              <span>ğŸ‘¤</span>
              <span>å€‹äººè³‡æ–™</span>
              <span class="status-indicator status-required" id="personalStatus">å¿…å¡«</span>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="chineseName">ä¸­æ–‡å…¨å</label>
                <input type="text" id="chineseName" placeholder="è«‹è¼¸å…¥ä¸­æ–‡å…¨å" required>
              </div>
              <div class="form-group">
                <label for="height">èº«é«˜ (å…¬åˆ†)</label>
                <input type="number" id="height" placeholder="ä¾‹å¦‚ï¼š175" min="150" max="220" required>
              </div>
              <div class="form-group">
                <label for="weight">é«”é‡ (å…¬æ–¤)</label>
                <input type="number" id="weight" placeholder="ä¾‹å¦‚ï¼š70" min="40" max="150" required>
              </div>
            </div>
          </div>

          <!-- Flight Information Section -->
          <div class="form-section" id="flightSection">
            <div class="section-title">
              <span>âœˆï¸</span>
              <span>èˆªç­è³‡è¨Š</span>
              <span class="status-indicator status-required" id="flightStatus">å¿…å¡«</span>
            </div>

            <div id="prefilledFlight" class="prefilled-info" style="display: none;">
              <div class="prefilled-text">âœ… å·²ç™»è¨˜çš„èˆªç­è³‡è¨Š</div>
              <div class="prefilled-details" id="prefilledDetails"></div>
            </div>

            <div id="flightInputs">
              <div class="form-group">
                <label>å‡ºç™¼æ—¥æœŸ</label>
                <div class="date-options">
                  <button type="button" class="date-btn" data-date="2025-06-19">6æœˆ19æ—¥</button>
                  <button type="button" class="date-btn" data-date="2025-06-20">6æœˆ20æ—¥</button>
                  <button type="button" class="date-btn" data-date="other">å…¶ä»–æ—¥æœŸ</button>
                </div>
                <div class="other-date-input" id="otherDateInput">
                  <input type="date" id="customDate" min="2025-06-01" max="2025-12-31">
                </div>
                <input type="hidden" id="selectedDate">
              </div>

              <div class="form-group">
                <label>é¸æ“‡èˆªç­</label>
                <div class="flight-options">
                  <button type="button" class="flight-btn" data-flight="HX234-0800">
                    <div class="airline-logo">ğŸ”µ</div>
                    <div class="airline-name">HK Express é¦™æ¸¯å¿«é‹</div>
                    <div class="flight-info">
                      <span class="flight-time">08:00 - 09:30</span>
                    </div>
                  </button>

                  <button type="button" class="flight-btn" data-flight="CX420-0835">
                    <div class="airline-logo">ğŸŸ¢</div>
                    <div class="airline-name">Cathay Pacific åœ‹æ³°èˆªç©º</div>
                    <div class="flight-info">
                      <span class="flight-time">08:35 - 10:15</span>
                    </div>
                  </button>

                  <button type="button" class="flight-btn" data-flight="CI920-1010">
                    <div class="airline-logo">ğŸ”´</div>
                    <div class="airline-name">China Airlines ä¸­è¯èˆªç©º</div>
                    <div class="flight-info">
                      <span class="flight-time">10:10 - 11:45</span>
                    </div>
                  </button>

                  <button type="button" class="flight-btn" data-flight="AE390-1010">
                    <div class="airline-logo">ğŸŸ¡</div>
                    <div class="airline-name">Mandarin Airlines è¯ä¿¡èˆªç©º</div>
                    <div class="flight-info">
                      <span class="flight-time">10:10 - 11:45</span>
                    </div>
                  </button>

                  <button type="button" class="flight-btn" data-flight="CX422-1035">
                    <div class="airline-logo">ğŸŸ¢</div>
                    <div class="airline-name">Cathay Pacific åœ‹æ³°èˆªç©º</div>
                    <div class="flight-info">
                      <span class="flight-time">10:35 - 12:15</span>
                    </div>
                  </button>

                  <button type="button" class="flight-btn" data-flight="BR828-1205">
                    <div class="airline-logo">ğŸŸ¢</div>
                    <div class="airline-name">EVA Air é•·æ¦®èˆªç©º</div>
                    <div class="flight-info">
                      <span class="flight-time">12:05 - 13:40</span>
                    </div>
                  </button>

                  <button type="button" class="flight-btn" data-flight="HX236-1245">
                    <div class="airline-logo">ğŸ”µ</div>
                    <div class="airline-name">HK Express é¦™æ¸¯å¿«é‹</div>
                    <div class="flight-info">
                      <span class="flight-time">12:45 - 14:15</span>
                    </div>
                  </button>
                </div>
              </div>

              <div class="manual-input-toggle">
                <button type="button" class="toggle-btn" onclick="toggleManualInput()">
                  æˆ–æ‰‹å‹•è¼¸å…¥å…¶ä»–èˆªç­
                </button>
              </div>

              <div class="manual-input" id="manualInput">
                <div class="input-row">
                  <div class="form-group">
                    <label for="customAirline">èˆªç©ºå…¬å¸</label>
                    <input type="text" id="customAirline" placeholder="ä¾‹å¦‚ï¼šHK Express">
                  </div>
                  <div class="form-group">
                    <label for="customFlightNo">èˆªç­ç·¨è™Ÿ</label>
                    <input type="text" id="customFlightNo" placeholder="ä¾‹å¦‚ï¼šHX234">
                  </div>
                </div>
                <div class="input-row">
                  <div class="form-group">
                    <label for="customDeparture">èµ·é£›æ™‚é–“</label>
                    <input type="time" id="customDeparture">
                  </div>
                  <div class="form-group">
                    <label for="customArrival">æŠµé”æ™‚é–“</label>
                    <input type="time" id="customArrival">
                  </div>
                </div>
              </div>
            </div>
          </div>

          <input type="hidden" id="selectedFlight">
          <button type="submit" class="submit-btn">æäº¤è³‡æ–™</button>
        </form>
      </div>

      <div class="table-card">
        <div class="table-header">
          <h2 class="form-title">
            <span>ğŸ“Š</span>
            <span>éšŠå“¡ç™»è¨˜ç‹€æ³</span>
          </h2>
          <div class="member-count" id="memberCount">å·²ç™»è¨˜: 0 äºº</div>
        </div>
        
        <div id="tableContainer">
          <table id="memberTable">
            <thead>
              <tr>
                <th>éšŠå“¡å§“å</th>
                <th>ä¸­æ–‡å§“å</th>
                <th>èº«é«˜</th>
                <th>é«”é‡</th>
                <th>å‡ºç™¼æ—¥æœŸ</th>
                <th>èˆªç©ºå…¬å¸</th>
                <th>èµ·é£›æ™‚é–“</th>
              </tr>
            </thead>
            <tbody id="tableBody">
              <!-- Data will be populated here -->
            </tbody>
          </table>
          <div class="empty-state" id="emptyState">
            <div class="empty-state-icon">ğŸ“</div>
            <p>å°šæœªæœ‰éšŠå“¡å®Œæˆè³‡è¨Šç™»è¨˜</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    // Error handling function
    function showError(message) {
      console.error('Firebase Error:', message);
      document.getElementById('errorText').textContent = message;
      document.getElementById('errorAlert').classList.add('show');
      document.getElementById('loadingIndicator').style.display = 'none';
    }

    function hideLoading() {
      document.getElementById('loadingIndicator').style.display = 'none';
      document.getElementById('mainContent').style.display = 'block';
    }

    try {
      // Firebase imports with error handling
      const { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js");
      const { getDatabase, ref, push, onValue, set, get } = await import("https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js");
      const { 
        getAuth, 
        signInWithEmailAndPassword, 
        onAuthStateChanged, 
        signOut 
      } = await import("https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js");

      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyCGCaWivohAhxZDkKp7YGNp9deNetR3K4Y",
        authDomain: "jersey-app-bcefa.firebaseapp.com",
        databaseURL: "https://jersey-app-bcefa-default-rtdb.firebaseio.com",
        projectId: "jersey-app-bcefa",
        storageBucket: "jersey-app-bcefa.appspot.com",
        messagingSenderId: "778327507472",
        appId: "1:778327507472:web:057e3db1b767f0b137c095"
      };

      console.log('Initializing Firebase...');

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);
      const auth = getAuth(app);

      console.log('Firebase initialized successfully');

      // Global variables
      let existingFlightData = null;
      let selectedDateValue = null;
      let selectedFlightData = null;
      let isManualInput = false;
      let memberInfoData = {};
      let flightDataGlobal = {};

      // Flight data
      const predefinedFlightData = {
        'HX234-0800': { airline: 'HK Express é¦™æ¸¯å¿«é‹', flightNo: 'HX234', departure: '08:00', arrival: '09:30' },
        'CX420-0835': { airline: 'Cathay Pacific åœ‹æ³°èˆªç©º', flightNo: 'CX420', departure: '08:35', arrival: '10:15' },
        'CI920-1010': { airline: 'China Airlines ä¸­è¯èˆªç©º', flightNo: 'CI920', departure: '10:10', arrival: '11:45' },
        'AE390-1010': { airline: 'Mandarin Airlines è¯ä¿¡èˆªç©º', flightNo: 'AE390', departure: '10:10', arrival: '11:45' },
        'CX422-1035': { airline: 'Cathay Pacific åœ‹æ³°èˆªç©º', flightNo: 'CX422', departure: '10:35', arrival: '12:15' },
        'BR828-1205': { airline: 'EVA Air é•·æ¦®èˆªç©º', flightNo: 'BR828', departure: '12:05', arrival: '13:40' },
        'HX236-1245': { airline: 'HK Express é¦™æ¸¯å¿«é‹', flightNo: 'HX236', departure: '12:45', arrival: '14:15' }
      };

      // Make functions available globally
      window.showAdminLogin = showAdminLogin;
      window.closeAdminLogin = closeAdminLogin;
      window.logout = logout;
      window.toggleManualInput = toggleManualInput;

      // Test database connection
      console.log('Testing database connection...');
      try {
        const testRef = ref(db, '.info/connected');
        onValue(testRef, (snapshot) => {
          if (snapshot.val() === true) {
            console.log('Database connected successfully');
            hideLoading();
          } else {
            console.log('Database disconnected');
          }
        });
      } catch (error) {
        showError('ç„¡æ³•é€£æ¥åˆ°è³‡æ–™åº«ï¼š' + error.message);
        return;
      }

      // Auth state observer
      onAuthStateChanged(auth, (user) => {
        const adminLoginLink = document.getElementById('adminLoginLink');
        const adminLoggedIn = document.getElementById('adminLoggedIn');
        const adminEmailSpan = document.getElementById('adminEmail');
        
        if (user) {
          adminLoginLink.style.display = 'none';
          adminLoggedIn.style.display = 'block';
          adminEmailSpan.textContent = user.email;
        } else {
          adminLoginLink.style.display = 'block';
          adminLoggedIn.style.display = 'none';
        }
      });

      // Admin functions
      function showAdminLogin() {
        document.getElementById('adminModal').classList.add('show');
        document.getElementById('adminEmailInput').focus();
      }

      function closeAdminLogin() {
        document.getElementById('adminModal').classList.remove('show');
        document.getElementById('adminLoginForm').reset();
        document.getElementById('loginError').classList.remove('show');
        document.getElementById('adminEmailInput').value = '';
        document.getElementById('adminPasswordInput').value = '';
      }

      async function logout() {
        try {
          await signOut(auth);
          alert('å·²æˆåŠŸç™»å‡º');
        } catch (error) {
          console.error('ç™»å‡ºéŒ¯èª¤:', error);
          alert('ç™»å‡ºå¤±æ•—ï¼Œè«‹é‡è©¦');
        }
      }

      // Member selection handler
      document.getElementById('memberName').addEventListener('change', async function() {
        const memberName = this.value;
        if (!memberName) {
          resetForm();
          return;
        }
        await checkExistingData(memberName);
      });

      async function checkExistingData(memberName) {
        try {
          // Check flight data
          const flightSnapshot = await get(ref(db, `toyotama-flights/${memberName}`));
          const flightData = flightSnapshot.val();

          // Check member info data
          const memberSnapshot = await get(ref(db, `toyotama-member-info/${memberName}`));
          const memberData = memberSnapshot.val();

          if (flightData) {
            showPrefilledFlight(flightData);
            existingFlightData = flightData;
          } else {
            hidePrefilledFlight();
            existingFlightData = null;
          }

          if (memberData) {
            fillPersonalInfo(memberData);
          } else {
            clearPersonalInfo();
          }

          updateStatusIndicators(!!memberData, !!flightData);
        } catch (error) {
          console.error('æª¢æŸ¥ç¾æœ‰è³‡æ–™éŒ¯èª¤:', error);
          showError('æª¢æŸ¥ç¾æœ‰è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š' + error.message);
        }
      }

      function showPrefilledFlight(flightData) {
        const prefilledDiv = document.getElementById('prefilledFlight');
        const prefilledDetails = document.getElementById('prefilledDetails');
        const flightInputs = document.getElementById('flightInputs');
        const flightStatus = document.getElementById('flightStatus');
        
        prefilledDiv.style.display = 'block';
        flightInputs.style.display = 'none';
        
        prefilledDetails.innerHTML = `
          <strong>æ—¥æœŸï¼š</strong>${formatDateDMY(flightData.date)} | 
          <strong>èˆªç©ºå…¬å¸ï¼š</strong>${flightData.airline} | 
          <strong>èˆªç­ï¼š</strong>${flightData.flightNo} | 
          <strong>èµ·é£›ï¼š</strong>${flightData.departure} | 
          <strong>æŠµé”ï¼š</strong>${flightData.arrival}
        `;

        flightStatus.textContent = 'å·²å®Œæˆ';
        flightStatus.className = 'status-indicator status-completed';
        document.getElementById('selectedFlight').value = 'existing';
      }

      function hidePrefilledFlight() {
        const prefilledDiv = document.getElementById('prefilledFlight');
        const flightInputs = document.getElementById('flightInputs');
        const flightStatus = document.getElementById('flightStatus');
        
        prefilledDiv.style.display = 'none';
        flightInputs.style.display = 'block';
        
        flightStatus.textContent = 'å¿…å¡«';
        flightStatus.className = 'status-indicator status-required';
        document.getElementById('selectedFlight').value = '';
      }

      function fillPersonalInfo(memberData) {
        document.getElementById('chineseName').value = memberData.chineseName || '';
        document.getElementById('height').value = memberData.height || '';
        document.getElementById('weight').value = memberData.weight || '';
      }

      function clearPersonalInfo() {
        document.getElementById('chineseName').value = '';
        document.getElementById('height').value = '';
        document.getElementById('weight').value = '';
      }

      function updateStatusIndicators(hasPersonalInfo, hasFlightInfo) {
        const personalStatus = document.getElementById('personalStatus');
        
        if (hasPersonalInfo) {
          personalStatus.textContent = 'å·²å®Œæˆ';
          personalStatus.className = 'status-indicator status-completed';
        } else {
          personalStatus.textContent = 'å¿…å¡«';
          personalStatus.className = 'status-indicator status-required';
        }
      }

      function resetForm() {
        clearPersonalInfo();
        hidePrefilledFlight();
        resetFlightSelection();
        existingFlightData = null;
        updateStatusIndicators(false, false);
      }

      function resetFlightSelection() {
        document.querySelectorAll('.date-btn').forEach(btn => btn.classList.remove('selected'));
        document.querySelectorAll('.flight-btn').forEach(btn => btn.classList.remove('selected'));
        document.getElementById('otherDateInput').classList.remove('show');
        document.getElementById('manualInput').classList.remove('show');
        clearManualInputs();
        selectedDateValue = null;
        selectedFlightData = null;
        isManualInput = false;
      }

      // Date selection
      const dateButtons = document.querySelectorAll('.date-btn');
      dateButtons.forEach(button => {
        button.addEventListener('click', function() {
          dateButtons.forEach(btn => btn.classList.remove('selected'));
          this.classList.add('selected');
          
          const dateValue = this.getAttribute('data-date');
          const otherDateInput = document.getElementById('otherDateInput');
          
          if (dateValue === 'other') {
            otherDateInput.classList.add('show');
            document.getElementById('customDate').focus();
            selectedDateValue = null;
          } else {
            otherDateInput.classList.remove('show');
            selectedDateValue = dateValue;
            document.getElementById('selectedDate').value = dateValue;
          }
        });
      });

      // Custom date input handler
      document.getElementById('customDate').addEventListener('change', function() {
        if (this.value) {
          selectedDateValue = this.value;
          document.getElementById('selectedDate').value = this.value;
        }
      });

      // Flight button selection
      const flightButtons = document.querySelectorAll('.flight-btn');
      flightButtons.forEach(button => {
        button.addEventListener('click', function() {
          isManualInput = false;
          document.getElementById('manualInput').classList.remove('show');
          clearManualInputs();

          flightButtons.forEach(btn => btn.classList.remove('selected'));
          this.classList.add('selected');
          
          const flightId = this.getAttribute('data-flight');
          selectedFlightData = predefinedFlightData[flightId];
          document.getElementById('selectedFlight').value = flightId;
        });
      });

      // Toggle manual input
      function toggleManualInput() {
        const manualInput = document.getElementById('manualInput');
        manualInput.classList.toggle('show');
        
        if (manualInput.classList.contains('show')) {
          isManualInput = true;
          flightButtons.forEach(btn => btn.classList.remove('selected'));
          selectedFlightData = null;
          document.getElementById('selectedFlight').value = 'manual';
        } else {
          isManualInput = false;
          clearManualInputs();
        }
      }

      function clearManualInputs() {
        document.getElementById('customAirline').value = '';
        document.getElementById('customFlightNo').value = '';
        document.getElementById('customDeparture').value = '';
        document.getElementById('customArrival').value = '';
      }

      // Format date for display
      function formatDateDMY(dateString) {
        const date = new Date(dateString + 'T00:00:00');
        const day = date.getDate().toString().padStart(2, '0');
        const month = (date.getMonth() + 1).toString().padStart(2, '0');
        const year = date.getFullYear();
        
        const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
        const weekday = weekdays[date.getDay()];
        
        return `${day}/${month}/${year} (${weekday})`;
      }

      // Admin login form handler
      document.getElementById('adminLoginForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const email = document.getElementById('adminEmailInput').value;
        const password = document.getElementById('adminPasswordInput').value;
        const loginBtn = document.getElementById('loginSubmitBtn');
        const loginBtnText = document.getElementById('loginBtnText');
        const loginError = document.getElementById('loginError');
        const errorMessage = document.getElementById('errorMessage');
        
        loginBtn.disabled = true;
        loginBtnText.innerHTML = '<span class="loading-spinner"></span>ç™»å…¥ä¸­...';
        loginError.classList.remove('show');
        
        try {
          await signInWithEmailAndPassword(auth, email, password);
          closeAdminLogin();
        } catch (error) {
          let errorText = 'ç™»å…¥å¤±æ•—';
          
          switch (error.code) {
            case 'auth/invalid-email':
              errorText = 'Email æ ¼å¼éŒ¯èª¤';
              break;
            case 'auth/user-disabled':
              errorText = 'æ­¤å¸³è™Ÿå·²è¢«åœç”¨';
              break;
            case 'auth/user-not-found':
              errorText = 'æ‰¾ä¸åˆ°æ­¤ä½¿ç”¨è€…';
              break;
            case 'auth/wrong-password':
              errorText = 'å¯†ç¢¼éŒ¯èª¤';
              break;
            case 'auth/invalid-credential':
              errorText = 'Email æˆ–å¯†ç¢¼éŒ¯èª¤';
              break;
            case 'auth/too-many-requests':
              errorText = 'ç™»å…¥å˜—è©¦æ¬¡æ•¸éå¤šï¼Œè«‹ç¨å¾Œå†è©¦';
              break;
            case 'auth/missing-email':
              errorText = 'è«‹è¼¸å…¥ Email';
              break;
            default:
              errorText = error.message;
          }
          
          errorMessage.textContent = errorText;
          loginError.classList.add('show');
        } finally {
          loginBtn.disabled = false;
          loginBtnText.textContent = 'ç™»å…¥';
        }
      });

      // Click outside to close modal
      document.getElementById('adminModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeAdminLogin();
        }
      });

      // Form submission
      document.getElementById('memberForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const memberName = document.getElementById('memberName').value;
        const chineseName = document.getElementById('chineseName').value;
        const height = document.getElementById('height').value;
        const weight = document.getElementById('weight').value;
        
        if (!memberName || !chineseName || !height || !weight) {
          alert('è«‹å¡«å¯«å®Œæ•´çš„å€‹äººè³‡æ–™ï¼');
          return;
        }

        const memberInfo = {
          chineseName: chineseName,
          height: parseInt(height),
          weight: parseInt(weight),
          timestamp: Date.now()
        };

        try {
          // Save personal info
          await set(ref(db, `toyotama-member-info/${memberName}`), memberInfo);

          // Save flight info if new flight is selected
          if (!existingFlightData) {
            if (!selectedDateValue && !document.getElementById('customDate').value) {
              alert('è«‹é¸æ“‡å‡ºç™¼æ—¥æœŸï¼');
              return;
            }

            const flightDate = selectedDateValue || document.getElementById('customDate').value;
            let flightInfo;

            if (isManualInput) {
              const airline = document.getElementById('customAirline').value;
              const flightNo = document.getElementById('customFlightNo').value;
              const departure = document.getElementById('customDeparture').value;
              const arrival = document.getElementById('customArrival').value;

              if (!airline || !flightNo || !departure || !arrival) {
                alert('è«‹å¡«å¯«å®Œæ•´çš„èˆªç­è³‡è¨Šï¼');
                return;
              }

              flightInfo = {
                airline: airline,
                flightNo: flightNo,
                departure: departure,
                arrival: arrival,
                date: flightDate
              };
            } else {
              if (!selectedFlightData) {
                alert('è«‹é¸æ“‡èˆªç­ï¼');
                return;
              }
              flightInfo = {
                ...selectedFlightData,
                date: flightDate
              };
            }

            await set(ref(db, `toyotama-flights/${memberName}`), {
              ...flightInfo,
              timestamp: Date.now()
            });
          }

          alert(`âœ… ${memberName} çš„è³‡æ–™å·²ç™»è¨˜æˆåŠŸï¼`);
          
          // Reset form
          document.getElementById('memberForm').reset();
          resetForm();
          
        } catch (error) {
          alert('âŒ ç™»è¨˜å¤±æ•—ï¼Œè«‹é‡è©¦ï¼');
          console.error('ä¿å­˜éŒ¯èª¤:', error);
        }
      });

      // Listen for data changes
      const memberInfoRef = ref(db, 'toyotama-member-info');
      const flightsRef = ref(db, 'toyotama-flights');

      onValue(memberInfoRef, (snapshot) => {
        memberInfoData = snapshot.val() || {};
        updateTable();
      }, (error) => {
        console.error('ç›£è½æœƒå“¡è³‡æ–™éŒ¯èª¤:', error);
        showError('ç„¡æ³•è¼‰å…¥æœƒå“¡è³‡æ–™ï¼š' + error.message);
      });

      onValue(flightsRef, (snapshot) => {
        flightDataGlobal = snapshot.val() || {};
        updateTable();
      }, (error) => {
        console.error('ç›£è½èˆªç­è³‡æ–™éŒ¯èª¤:', error);
        showError('ç„¡æ³•è¼‰å…¥èˆªç­è³‡æ–™ï¼š' + error.message);
      });

      function updateTable() {
        const tableBody = document.getElementById('tableBody');
        const emptyState = document.getElementById('emptyState');
        const table = document.getElementById('memberTable');
        const memberCount = document.getElementById('memberCount');

        tableBody.innerHTML = '';

        // Get members who have both personal info and flight info
        const completeMembers = Object.keys(memberInfoData).filter(member => 
          memberInfoData[member] && flightDataGlobal[member]
        );

        if (completeMembers.length === 0) {
          table.style.display = 'none';
          emptyState.style.display = 'block';
          memberCount.textContent = 'å·²ç™»è¨˜: 0 äºº';
          return;
        }

        table.style.display = 'table';
        emptyState.style.display = 'none';
        memberCount.textContent = `å·²ç™»è¨˜: ${completeMembers.length} äºº`;

        // Sort by date and departure time
        completeMembers.sort((a, b) => {
          const dateA = flightDataGlobal[a].date;
          const dateB = flightDataGlobal[b].date;
          const timeA = flightDataGlobal[a].departure;
          const timeB = flightDataGlobal[b].departure;
          
          if (dateA !== dateB) {
            return dateA.localeCompare(dateB);
          }
          return timeA.localeCompare(timeB);
        });

        completeMembers.forEach(member => {
          const memberInfo = memberInfoData[member];
          const flight = flightDataGlobal[member];
          const row = document.createElement('tr');
          
          row.innerHTML = `
            <td class="member-name">${member}</td>
            <td>${memberInfo.chineseName}</td>
            <td>${memberInfo.height} cm</td>
            <td>${memberInfo.weight} kg</td>
            <td>
              <span class="date-badge">${formatDateDMY(flight.date)}</span>
            </td>
            <td>
              <span class="airline-tag">${flight.airline}</span>
            </td>
            <td>
              <span class="time-badge">${flight.departure}</span>
            </td>
          `;
          
          tableBody.appendChild(row);
        });
      }

      console.log('All event listeners attached successfully');

    } catch (error) {
      console.error('Script initialization error:', error);
      showError('ç³»çµ±åˆå§‹åŒ–å¤±æ•—ï¼š' + error.message);
    }
  </script>
</body>
</html>